# ラボ 4A: データストアの操作

データ サイエンティストがローカル ファイル システム上のデータを操作することはかなり一般的ですが、エンタープライズ環境では、複数のデータ サイエンティストがアクセスできる中央の場所にデータを格納する方が効果的です。このラボでは、クラウドにデータを格納し、*Azure Machine Learning データストア*を使用してデータにアクセスします。

## 開始する前に

このラボを開始する前に、このラボで使用する Azure Machine Learning ワークスペースと他のリソースを作成するタスクを含む[ラボ 1A](Lab01A.md) と[ラボ 1B](Lab01B.md) を完了させてください。

## タスク 1: Azure Storage コンテナーの作成
Azure Machine Learning では、さまざまな種類の Azure データ ソースを使用できます。このラボでは、BLOB コンテナーを含む Azure ストレージ アカウントを作成します。

1. [Azure portal](https://portal.azure.com) にサインイン し、Azure Machine Learning ワークスペースを含むリソース グループを開きます。ワークスペースで作成された Azure ストレージ アカウントが既に含まれていることに注意してください。

    >**注**: ワークスペースで作成されたストレージ アカウントは、構成データ、Notebooks、登録モデルなどを格納するためにサービスによって使用されます。また、実験やモデル トレーニング用のデータを保存するために使用することもできますが、多くの場合、このデータを個別に管理する必要があります。

2. 次の設定を使って、新しい**ストレージ アカウント**をリソース グループに追加します。

    - **ストレージ アカウント名**: 一意の名前。
    - **保存先**: ワークスペースと同じ場所
    - **パフォーマンス**: Standard
    - **アカウントの種類**: StorageV2 (汎用 v2)
    - **レプリケーション**: ローカル冗長ストレージ (LRS)
    - **ネットワークの既定**: 規定の設定を使用する

3. ストレージ アカウントが作成されるのを待ってから、ポータルでリソースに移動します。
4. ストレージ アカウントの**コンテナー** ページを開き、次の設定を使って、コンテナーを追加します。

    - **名前**: aml-data
    - **パブリック アクセス レベル**: プライベート (匿名アクセスはありません)

5. コンテナーを追加したら、ストレージ アカウントの**アクセス キー** ページを表示し、**key1** をクリップボードにコピーします。これは次のタスクで必要になります。

## タスク 2: Azure Machine Learning データストアの登録

ストレージ コンテナーを作成したので、Azure Machine Learning ワークスペースにデータストアとして登録できます。

1. [Azure Machine Learning Studio](https://ml.azure.com) で、ワークスペースの**データストア** ページを表示します。事前定義されたデータストアが一覧表示されます。
2. 次の設定を使って、新しいデータストアを作成します。
    - **データストア名**: aml_data
    - **データストアの種類**: Azure Blob Storage
    - **アカウント選択方法**: Azure サブスクリプションから
    - **サブスクリプション ID**: *Azure サブスクリプション*
    - **ストレージ アカウント**: *前のタスク作成したストレージ アカウント*
    - **BLOB コンテナー**: aml-data
    - **認証の種類**: アカウント キー
    - **アカウント キー**: *前のタスクでコピーしたキーを貼り付ける*
3. データストアが追加されたら、**データストア** ページに表示されていることを確認します。

## タスク 3: Azure Machine Learning SDK を使用して、データストアにアクセスする

このタスクでは、Azure Machine Learning SDK を使用して、データストアとの間でデータをアップロードおよびダウンロードします。

1. [Azure Machine Learning Studio](https://ml.azure.com) で、ワークスペースの**コンピューティング** ページを表示し、**コンピューティング インスタンス** タブでコンピューティング インスタンスを開始します。
2. コンピューティング インスタンスが実行されている場合は、ブラウザーで Azure Machine Learning Studio の Web ページを更新して、認証セッションの有効期限が切れていないことを確認します。次に、**Jupyter** リンクをクリックして、新しいブラウザー タブで Jupyter のホーム ページを開きます。
3. Jupyter のホーム ページの**Users/DP100** フォルダーで、**04A - Working with Datastores.ipynb** Notebook を開きます。次に、Notebook 内の注意事項を読み、各コード セルを順番に実行します。
4. Notebook 内のコードの実行が終了したら、**ファイル** メニューの **閉じて停止(Close and Halt)** をクリックして閉じ、Python カーネルをシャットダウンします。その後、すべての Jupyter ブラウザー タブを閉じます。
5. Azure Machine Learning Studio の**コンピューティング** ページで、コンピューティング インスタンスを選択し、**停止**をクリックしてシャットダウンします。
